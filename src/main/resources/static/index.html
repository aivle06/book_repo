<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AWS Spring Boot 3.x CI/CD ì¸í„°ë™í‹°ë¸Œ ê°€ì´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc; /* Warm neutral/light gray */
            color: #334155;
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: monospace;
            white-space: pre;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .step-active {
            border-bottom: 3px solid #f97316; /* AWS Orange */
            color: #c2410c;
            font-weight: 700;
        }
        .step-inactive {
            border-bottom: 3px solid transparent;
            color: #64748b;
        }
        .step-inactive:hover {
            color: #334155;
            border-bottom: 3px solid #cbd5e1;
        }
        /* Chart Container Styling per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease-in-out;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Header & Navigation -->
<header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center cursor-pointer" onclick="app.navigateTo('overview')">
                <span class="text-2xl font-bold text-slate-800">AWS <span class="text-orange-500">CI/CD</span> Builder</span>
            </div>
            <div class="hidden md:flex space-x-1">
                <!-- Nav generated by JS -->
                <div id="nav-container" class="flex space-x-4"></div>
            </div>
            <!-- Mobile menu button placeholder -->
            <div class="md:hidden">
                <button class="text-slate-500 hover:text-slate-700" onclick="alert('ë°ìŠ¤í¬íƒ‘ í™”ë©´ì—ì„œ ìµœì ì˜ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.')">ë©”ë‰´</button>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

    <!-- Dynamic Content Section -->
    <div id="content-area" class="animate-fade-in">
        <!-- Content injected here by JS -->
    </div>

</main>

<!-- Footer -->
<footer class="bg-slate-800 text-slate-300 py-8 mt-8">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <p class="mb-2">Spring Boot 3.x AWS ë°°í¬ ìë™í™” ê°€ì´ë“œ</p>
        <p class="text-sm text-slate-500">&copy; 2025 CI/CD Interactive Guide. Updated with Ohio Region Support.</p>
    </div>
</footer>

<script>
    // --- Data & State ---
    const appState = {
        currentStep: 'overview',
        ec2Region: 'ap-northeast-2',
        troubleshootFilter: 'all'
    };

    const steps = [
        { id: 'overview', label: 'ê°œìš”', title: 'ì•„í‚¤í…ì²˜ ê°œìš”' },
        { id: 'files', label: '1. íŒŒì¼ ì¤€ë¹„', title: 'í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼' },
        { id: 'iam', label: '2. ê¶Œí•œ(IAM)', title: 'IAM ì—­í•  êµ¬ì„±' },
        { id: 'ec2', label: '3. ì„œë²„(EC2)', title: 'EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •' },
        { id: 'deploy', label: '4. ë°°í¬ ì„¤ì •', title: 'CodeDeploy & Pipeline' },
        { id: 'troubleshoot', label: 'íŠ¸ëŸ¬ë¸”ìŠˆíŒ…', title: 'ë¬¸ì œ í•´ê²° ê°€ì´ë“œ' }
    ];

    // UPDATED: File Contents based on user request
    const fileContents = {
        buildspec: `version: 0.2

phases:
  install:
    runtime-versions:
      java: 17
    commands:
      - chmod +x ./gradlew
  build:
    commands:
      - ./gradlew build

artifacts:
  files:
    - build/libs/*.jar
    - appspec.yml
    - scripts/**
    - src/main/resources/static/** # <--- ì •ì  ë¦¬ì†ŒìŠ¤ í¬í•¨`,
        appspec: `version: 0.0
os: linux
files:
  - source: /
    destination: /home/ec2-user/app
    overwrite: yes

permissions:
  - object: /home/ec2-user/app
    owner: ec2-user
    group: ec2-user
    mode: 755

hooks:
  ApplicationStart:
    - location: scripts/start.sh
      timeout: 60
      runas: ec2-user`,
        startScript: `#!/bin/bash
cd /home/ec2-user/app

echo "> í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ pid í™•ì¸"
CURRENT_PID=$(pgrep -f .jar)

if [ -z "$CURRENT_PID" ]; then
  echo "> í˜„ì¬ êµ¬ë™ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì—†ìœ¼ë¯€ë¡œ ì¢…ë£Œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
else
  echo "> ì‹¤í–‰ ì¤‘ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ (PID: $CURRENT_PID)"
  kill -15 $CURRENT_PID
  sleep 5
fi

# ê¸°ì¡´ ë¡œì§: ê°€ì¥ ìµœì‹  JAR íŒŒì¼ ì°¾ê¸° (plain jar ì œì™¸)
JAR_NAME=$(find . -name "*.jar" ! -name "*plain.jar" | tail -n 1)

echo "> ìƒˆ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬: $JAR_NAME"

chmod +x $JAR_NAME

# nohupìœ¼ë¡œ ì‹¤í–‰ (ì ˆëŒ€ ê²½ë¡œ ë¡œê·¸ ë° ì…ë ¥ ë¦¬ë‹¤ì´ë ‰ì…˜ ëª…ì‹œ)
nohup java -jar $JAR_NAME > /home/ec2-user/app/nohup.out 2>&1 < /dev/null &`
    };

    // --- Core Logic ---
    const app = {
        init: () => {
            app.renderNav();
            app.navigateTo('overview');
        },

        navigateTo: (stepId) => {
            appState.currentStep = stepId;
            app.renderNav();
            app.renderContent(stepId);
        },

        renderNav: () => {
            const navContainer = document.getElementById('nav-container');
            navContainer.innerHTML = steps.map(step => `
                    <button
                        onclick="app.navigateTo('${step.id}')"
                        class="px-3 py-2 text-sm font-medium transition-colors duration-200 ${appState.currentStep === step.id ? 'step-active' : 'step-inactive'}"
                    >
                        ${step.label}
                    </button>
                `).join('');
        },

        renderContent: (stepId) => {
            const container = document.getElementById('content-area');
            let html = '';

            // Section Intro Wrapper
            const sectionIntro = (title, desc) => `
                    <div class="mb-8 text-center max-w-3xl mx-auto">
                        <h1 class="text-3xl font-bold text-slate-800 mb-4">${title}</h1>
                        <p class="text-lg text-slate-600">${desc}</p>
                    </div>
                `;

            switch (stepId) {
                case 'overview':
                    html = `
                            ${sectionIntro('AWS Spring Boot 3.x CI/CD íŒŒì´í”„ë¼ì¸', 'GitHubì˜ ì½”ë“œê°€ ìë™ìœ¼ë¡œ ë¹Œë“œë˜ì–´ EC2 ì„œë²„ì— ë°°í¬ë˜ëŠ” ì „ì²´ ê³¼ì •ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.')}
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-12 items-center text-center">
                                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-gray-800 card-hover">
                                    <div class="text-4xl mb-2">ğŸ“‚</div>
                                    <h3 class="font-bold">GitHub</h3>
                                    <p class="text-sm text-gray-500">Source</p>
                                </div>
                                <div class="text-2xl text-gray-400 font-bold hidden md:block">â†’</div>
                                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-blue-500 card-hover">
                                    <div class="text-4xl mb-2">ğŸ”¨</div>
                                    <h3 class="font-bold">CodeBuild</h3>
                                    <p class="text-sm text-gray-500">Build (Java 17)</p>
                                </div>
                                <div class="text-2xl text-gray-400 font-bold hidden md:block">â†’</div>
                                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-green-500 card-hover">
                                    <div class="text-4xl mb-2">ğŸš€</div>
                                    <h3 class="font-bold">CodeDeploy</h3>
                                    <p class="text-sm text-gray-500">Deploy</p>
                                </div>
                                <div class="text-2xl text-gray-400 font-bold hidden md:block">â†’</div>
                                <div class="bg-white p-6 rounded-lg shadow-md border-t-4 border-orange-500 card-hover">
                                    <div class="text-4xl mb-2">ğŸ’»</div>
                                    <h3 class="font-bold">EC2</h3>
                                    <p class="text-sm text-gray-500">Server (App)</p>
                                </div>
                            </div>

                            <div class="bg-blue-50 p-6 rounded-xl border border-blue-100">
                                <h3 class="text-xl font-bold text-blue-800 mb-2">ì‹œì‘í•˜ê¸° ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
                                <ul class="list-disc list-inside space-y-2 text-blue-700">
                                    <li>Spring Boot 3.x í”„ë¡œì íŠ¸ (Java 17 í•„ìˆ˜)</li>
                                    <li>AWS ê³„ì • ë° ì½˜ì†” ì ‘ê·¼ ê¶Œí•œ</li>
                                    <li>GitHub ë¦¬í¬ì§€í† ë¦¬</li>
                                </ul>
                                <div class="mt-6 text-center">
                                    <button onclick="app.navigateTo('files')" class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold hover:bg-blue-700 transition shadow-lg">
                                        êµ¬ì¶• ì‹œì‘í•˜ê¸° âœ
                                    </button>
                                </div>
                            </div>
                        `;
                    break;

                case 'files':
                    html = `
                            ${sectionIntro('1ë‹¨ê³„: í”„ë¡œì íŠ¸ ì„¤ì • íŒŒì¼ ì¤€ë¹„', 'ì—…ë°ì´íŠ¸ëœ ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤. í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œ ë° scripts í´ë”ì— ì •í™•íˆ ë°°ì¹˜í•˜ì„¸ìš”.')}

                            <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
                                <div class="flex border-b bg-gray-50">
                                    <button onclick="app.switchTab('buildspec')" id="tab-buildspec" class="flex-1 py-4 text-center font-bold text-blue-600 border-b-2 border-blue-600 hover:bg-gray-100 transition">buildspec.yml</button>
                                    <button onclick="app.switchTab('appspec')" id="tab-appspec" class="flex-1 py-4 text-center font-medium text-gray-500 hover:text-blue-600 hover:bg-gray-100 transition">appspec.yml</button>
                                    <button onclick="app.switchTab('script')" id="tab-script" class="flex-1 py-4 text-center font-medium text-gray-500 hover:text-blue-600 hover:bg-gray-100 transition">scripts/start.sh</button>
                                </div>

                                <div class="p-6">
                                    <div id="content-buildspec" class="block">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-semibold text-gray-600">CodeBuild ë¹Œë“œ ëª…ì„¸ì„œ (static ë¦¬ì†ŒìŠ¤ í¬í•¨)</span>
                                            <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">ë£¨íŠ¸ ê²½ë¡œ ìœ„ì¹˜</span>
                                        </div>
                                        <div class="code-block">${fileContents.buildspec}</div>
                                    </div>
                                    <div id="content-appspec" class="hidden">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-semibold text-gray-600">CodeDeploy ë°°í¬ ëª…ì„¸ì„œ</span>
                                            <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">ë£¨íŠ¸ ê²½ë¡œ ìœ„ì¹˜</span>
                                        </div>
                                        <div class="code-block">${fileContents.appspec}</div>
                                    </div>
                                    <div id="content-script" class="hidden">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-sm font-semibold text-gray-600">ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (PID ì²´í¬ ê°œì„ ë¨)</span>
                                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">scripts í´ë” ìƒì„± í•„ìš”</span>
                                        </div>
                                        <div class="code-block">${fileContents.startScript}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    break;

                case 'iam':
                    html = `
                            ${sectionIntro('2ë‹¨ê³„: IAM ì—­í• (Role) ìƒì„±', 'AWS ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì„ ìœ„í•´ ë‘ ê°€ì§€ ì—­í• ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.')}

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <!-- Role 1 -->
                                <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-orange-500 relative">
                                    <div class="absolute top-4 right-4 text-orange-200 text-6xl opacity-20 font-bold">1</div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">EC2ìš© ì—­í• </h3>
                                    <p class="text-sm text-gray-500 mb-4">EC2 ì¸ìŠ¤í„´ìŠ¤ê°€ ë°°í¬ ì—ì´ì „íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³  S3ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

                                    <div class="space-y-3">
                                        <div class="flex items-start">
                                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mr-2 mt-1">ì‹ ë¢° ê´€ê³„</span>
                                            <span class="font-medium">ec2.amazonaws.com</span>
                                        </div>
                                        <div class="flex items-start">
                                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mr-2 mt-1">í•„ìˆ˜ ì •ì±…</span>
                                            <span class="text-orange-600 font-bold text-sm">AmazonEC2RoleforAWSCodeDeploy</span>
                                        </div>
                                        <div class="flex items-start">
                                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mr-2 mt-1">ê¶Œì¥ ì •ì±…</span>
                                            <span class="text-gray-600 text-sm">AmazonS3ReadOnlyAccess</span>
                                        </div>
                                        <div class="mt-4 p-3 bg-gray-50 rounded border border-gray-200 text-center">
                                            <span class="text-xs text-gray-500">ì¶”ì²œ ì´ë¦„</span><br>
                                            <code class="font-bold text-lg">EC2-CodeDeploy-Role</code>
                                        </div>
                                    </div>
                                </div>

                                <!-- Role 2 -->
                                <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-green-500 relative">
                                    <div class="absolute top-4 right-4 text-green-200 text-6xl opacity-20 font-bold">2</div>
                                    <h3 class="text-xl font-bold text-gray-800 mb-2">CodeDeployìš© ì—­í• </h3>
                                    <p class="text-sm text-gray-500 mb-4">CodeDeploy ì„œë¹„ìŠ¤ ìì²´ê°€ EC2ë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

                                    <div class="space-y-3">
                                        <div class="flex items-start">
                                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mr-2 mt-1">ì‹ ë¢° ê´€ê³„</span>
                                            <span class="font-medium">codedeploy.amazonaws.com</span>
                                        </div>
                                        <div class="flex items-start">
                                            <span class="bg-gray-200 text-gray-700 text-xs px-2 py-1 rounded mr-2 mt-1">í•„ìˆ˜ ì •ì±…</span>
                                            <span class="text-green-600 font-bold text-sm">AWSCodeDeployRole</span>
                                        </div>
                                        <div class="mt-4 p-3 bg-gray-50 rounded border border-gray-200 text-center">
                                            <span class="text-xs text-gray-500">ì¶”ì²œ ì´ë¦„</span><br>
                                            <code class="font-bold text-lg">CodeDeploy-Service-Role</code>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    break;

                case 'ec2':
                    html = `
                            ${sectionIntro('3ë‹¨ê³„: EC2 ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •', 'CodeDeploy ì—ì´ì „íŠ¸ ìë™ ì„¤ì¹˜ë¥¼ ìœ„í•œ User Data ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.')}

                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                                <!-- Configuration Panel -->
                                <div class="col-span-1 bg-white p-6 rounded-xl shadow-lg border border-gray-200 h-fit">
                                    <h3 class="font-bold text-lg mb-4 text-slate-800">ì„¤ì • ì˜µì…˜</h3>

                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">ë¦¬ì „ (Region)</label>
                                        <select id="region-selector" onchange="app.updateUserData()" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none">
                                            <option value="ap-northeast-2">Seoul (ap-northeast-2)</option>
                                            <option value="us-east-1">N. Virginia (us-east-1)</option>
                                            <option value="us-east-2">Ohio (us-east-2)</option>
                                            <option value="us-west-2">Oregon (us-west-2)</option>
                                            <option value="eu-west-1">Ireland (eu-west-1)</option>
                                        </select>
                                    </div>

                                    <div class="mb-6">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">í•„ìˆ˜ íƒœê·¸ (Tag)</label>
                                        <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                                            <div class="flex justify-between mb-1">
                                                <span class="text-xs font-bold text-gray-500">Key</span>
                                                <span class="text-xs font-bold text-gray-500">Value</span>
                                            </div>
                                            <div class="flex justify-between font-mono font-bold text-slate-700">
                                                <span>Environment</span>
                                                <span>Dev</span>
                                            </div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">* ë°°í¬ ê·¸ë£¹ì—ì„œ ì´ íƒœê·¸ë¥¼ ì°¾ì•„ ë°°í¬í•©ë‹ˆë‹¤.</p>
                                    </div>
                                </div>

                                <!-- Script Output -->
                                <div class="col-span-1 lg:col-span-2">
                                    <div class="bg-slate-900 rounded-xl overflow-hidden shadow-lg">
                                        <div class="bg-slate-800 px-4 py-2 flex justify-between items-center">
                                            <span class="text-gray-300 text-sm font-mono">User Data Script</span>
                                            <button class="text-xs bg-slate-700 text-white px-2 py-1 rounded hover:bg-slate-600" onclick="navigator.clipboard.writeText(document.getElementById('userdata-display').textContent); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!')">Copy</button>
                                        </div>
                                        <div class="p-4 overflow-x-auto">
                                            <pre id="userdata-display" class="text-green-400 font-mono text-sm leading-relaxed"></pre>
                                        </div>
                                    </div>
                                    <div class="mt-4 p-4 bg-orange-50 border-l-4 border-orange-400 text-sm text-orange-800">
                                        <strong>ì¤‘ìš”:</strong> ë¦¬ì „ ì„ íƒì— ë”°ë¼ <code>wget</code> ë‹¤ìš´ë¡œë“œ ê²½ë¡œê°€ ìë™ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤. í˜„ì¬ ì„ íƒëœ ë¦¬ì „ì´ EC2ë¥¼ ìƒì„±í•˜ë ¤ëŠ” ë¦¬ì „ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê¼­ í™•ì¸í•˜ì„¸ìš”.
                                    </div>
                                </div>
                            </div>
                        `;
                    break;

                case 'deploy':
                    html = `
                            ${sectionIntro('4 & 5ë‹¨ê³„: ë°°í¬ ê·¸ë£¹ ë° íŒŒì´í”„ë¼ì¸ êµ¬ì„±', 'CodeDeployì™€ Pipelineì„ ì—°ê²°í•©ë‹ˆë‹¤. ì„¤ì •ê°’ì˜ ì¼ì¹˜ ì—¬ë¶€ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤.')}

                            <div class="space-y-8">
                                <!-- Step 4 -->
                                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                                    <div class="bg-green-600 px-6 py-4">
                                        <h3 class="text-white font-bold text-lg">4. CodeDeploy ë°°í¬ ê·¸ë£¹ ì„¤ì •</h3>
                                    </div>
                                    <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4">
                                        <div>
                                            <span class="block text-xs text-gray-500 uppercase tracking-wide">Application Name</span>
                                            <span class="font-bold text-gray-800">MySpringBootApp</span>
                                        </div>
                                        <div>
                                            <span class="block text-xs text-gray-500 uppercase tracking-wide">Deployment Group</span>
                                            <span class="font-bold text-gray-800">MyDevGroup</span>
                                        </div>
                                        <div>
                                            <span class="block text-xs text-gray-500 uppercase tracking-wide">Service Role</span>
                                            <span class="font-bold text-green-700">CodeDeploy-Service-Role</span>
                                        </div>
                                        <div>
                                            <span class="block text-xs text-gray-500 uppercase tracking-wide">Environment Tag</span>
                                            <span class="font-mono bg-gray-100 px-2 rounded">Environment = Dev</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex justify-center text-3xl text-gray-300">â¬‡</div>

                                <!-- Step 5 -->
                                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                                    <div class="bg-blue-600 px-6 py-4">
                                        <h3 class="text-white font-bold text-lg">5. CodePipeline ì—°ê²°</h3>
                                    </div>
                                    <div class="p-6">
                                        <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">

                                            <!-- Source -->
                                            <div class="text-center w-full md:w-1/3 p-4 border rounded-lg bg-gray-50">
                                                <div class="font-bold text-slate-700 mb-1">Source</div>
                                                <div class="text-sm text-gray-600">GitHub (Version 2)</div>
                                                <div class="text-xs text-gray-400 mt-1">ë¦¬í¬ì§€í† ë¦¬ / ë¸Œëœì¹˜ ì„ íƒ</div>
                                            </div>

                                            <div class="text-2xl text-gray-400 font-bold">â†’</div>

                                            <!-- Build -->
                                            <div class="text-center w-full md:w-1/3 p-4 border rounded-lg bg-gray-50">
                                                <div class="font-bold text-slate-700 mb-1">Build</div>
                                                <div class="text-sm text-gray-600">AWS CodeBuild</div>
                                                <div class="text-xs text-gray-400 mt-1">Amazon Linux 2 / Standard 5.0</div>
                                                <div class="text-xs text-blue-600 font-bold mt-1">Java 17 ì§€ì› í™•ì¸</div>
                                            </div>

                                            <div class="text-2xl text-gray-400 font-bold">â†’</div>

                                            <!-- Deploy -->
                                            <div class="text-center w-full md:w-1/3 p-4 border rounded-lg bg-gray-50">
                                                <div class="font-bold text-slate-700 mb-1">Deploy</div>
                                                <div class="text-sm text-gray-600">AWS CodeDeploy</div>
                                                <div class="text-xs text-gray-400 mt-1">App: MySpringBootApp</div>
                                                <div class="text-xs text-gray-400">Group: MyDevGroup</div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    break;

                case 'troubleshoot':
                    html = `
                            ${sectionIntro('6ë‹¨ê³„: íŠ¸ëŸ¬ë¸”ìŠˆíŒ… & ë¶„ì„', 'ë°°í¬ ì‹¤íŒ¨ ì‹œ ì•„ë˜ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ì„¸ìš”.')}

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                                <!-- Common Issues Chart -->
                                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                    <h3 class="font-bold text-gray-800 mb-4">ì£¼ìš” ë°°í¬ ì‹¤íŒ¨ ì›ì¸ ë¶„ì„</h3>
                                    <div class="chart-container">
                                        <canvas id="errorChart"></canvas>
                                    </div>
                                    <p class="text-center text-xs text-gray-400 mt-4">ì¼ë°˜ì ì¸ CodeDeploy ë°°í¬ ì‹¤íŒ¨ ì‚¬ë¡€ í†µê³„</p>
                                </div>

                                <!-- Interactive Diagnostic -->
                                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                                    <h3 class="font-bold text-gray-800 mb-4">ì¦ìƒë³„ í•´ê²° ê°€ì´ë“œ</h3>
                                    <div class="space-y-4">
                                        <details class="group bg-red-50 rounded-lg p-4 cursor-pointer">
                                            <summary class="font-medium text-red-800 flex justify-between items-center">
                                                <span>Eventsê°€ ê³„ì† "Pending" ìƒíƒœì„</span>
                                                <span class="transition group-open:rotate-180">â–¼</span>
                                            </summary>
                                            <div class="mt-3 text-sm text-red-700 pl-4 border-l-2 border-red-200">
                                                <p class="mb-2"><strong>ì›ì¸:</strong> ì—ì´ì „íŠ¸ ë¯¸ì‹¤í–‰ ë˜ëŠ” IAM ì—­í• (S3 ì ‘ê·¼ê¶Œí•œ) ëˆ„ë½.</p>
                                                <p class="font-bold mb-1">í•´ê²° (EC2 SSH):</p>
                                                <code class="bg-red-100 px-2 py-1 rounded block mb-1">sudo service codedeploy-agent restart</code>
                                                <code class="bg-red-100 px-2 py-1 rounded block">tail -f /var/log/aws/codedeploy-agent/codedeploy-agent.log</code>
                                            </div>
                                        </details>

                                        <details class="group bg-yellow-50 rounded-lg p-4 cursor-pointer">
                                            <summary class="font-medium text-yellow-800 flex justify-between items-center">
                                                <span>Lifecycle Event ìˆ˜ì‹  ì‹¤íŒ¨</span>
                                                <span class="transition group-open:rotate-180">â–¼</span>
                                            </summary>
                                            <div class="mt-3 text-sm text-yellow-800 pl-4 border-l-2 border-yellow-300">
                                                <p class="mb-2"><strong>ì›ì¸:</strong> IAM ì—­í• ì„ EC2 ìƒì„± "ì´í›„"ì— ì—°ê²°í–ˆë‹¤ë©´ ì—ì´ì „íŠ¸ ì¬ì‹œì‘ í•„ìˆ˜.</p>
                                                <p class="font-bold mb-1">í•´ê²°:</p>
                                                <p>IAM ì—­í•  ì—°ê²° í™•ì¸ í›„ ì—ì´ì „íŠ¸ ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•˜ì„¸ìš”.</p>
                                            </div>
                                        </details>

                                        <details class="group bg-blue-50 rounded-lg p-4 cursor-pointer">
                                            <summary class="font-medium text-blue-800 flex justify-between items-center">
                                                <span>Build ë‹¨ê³„ ê¶Œí•œ ì˜¤ë¥˜ (gradlew)</span>
                                                <span class="transition group-open:rotate-180">â–¼</span>
                                            </summary>
                                            <div class="mt-3 text-sm text-blue-800 pl-4 border-l-2 border-blue-200">
                                                <p class="mb-2"><strong>ì›ì¸:</strong> gradlew íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œ(x)ì´ ì—†ìŒ.</p>
                                                <p class="font-bold mb-1">í•´ê²° (Git):</p>
                                                <code class="bg-blue-100 px-2 py-1 rounded block">git update-index --chmod=+x gradlew</code>
                                                <p class="mt-1">buildspec.ymlì˜ install ë‹¨ê³„ chmod ëª…ë ¹ì–´ë„ í™•ì¸í•˜ì„¸ìš”.</p>
                                            </div>
                                        </details>
                                    </div>
                                </div>
                            </div>
                        `;
                    break;
            }

            container.innerHTML = html;

            // Post-render actions
            if (stepId === 'ec2') {
                app.updateUserData();
            }
            if (stepId === 'troubleshoot') {
                app.renderChart();
            }
        },

        switchTab: (tabId) => {
            // Reset styles
            ['buildspec', 'appspec', 'script'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                const content = document.getElementById(`content-${t}`);

                if (t === tabId) {
                    btn.className = "flex-1 py-4 text-center font-bold text-blue-600 border-b-2 border-blue-600 hover:bg-gray-100 transition";
                    content.classList.remove('hidden');
                    content.classList.add('block');
                } else {
                    btn.className = "flex-1 py-4 text-center font-medium text-gray-500 hover:text-blue-600 hover:bg-gray-100 transition";
                    content.classList.remove('block');
                    content.classList.add('hidden');
                }
            });
        },

        updateUserData: () => {
            const region = document.getElementById('region-selector').value;
            // The S3 bucket URL follows a standard pattern: aws-codedeploy-{region}.s3.{region}.amazonaws.com
            // This works for ap-northeast-2, us-east-1, us-east-2 (Ohio), etc.
            const script = `#!/bin/bash
yum update -y
# 1. Java 17 ë° í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
yum install -y ruby wget java-17-amazon-corretto

# 2. CodeDeploy ì—ì´ì „íŠ¸ ì„¤ì¹˜ (ì„ íƒëœ ë¦¬ì „: ${region})
cd /home/ec2-user
wget https://aws-codedeploy-${region}.s3.${region}.amazonaws.com/latest/install
chmod +x ./install
./install auto

# 3. ì„¤ì¹˜ í™•ì¸
# service codedeploy-agent status`;
            document.getElementById('userdata-display').textContent = script;
        },

        renderChart: () => {
            const ctx = document.getElementById('errorChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['IAM ê¶Œí•œ ëˆ„ë½', 'ì—ì´ì „íŠ¸ ë¯¸ì‹¤í–‰', 'ìŠ¤í¬ë¦½íŠ¸ ì˜¤ë¥˜', 'Java ë²„ì „ ë¶ˆì¼ì¹˜', 'ê²½ë¡œ ì„¤ì • ì˜¤ë¥˜'],
                    datasets: [{
                        label: 'ë°œìƒ ë¹ˆë„ (ì¶”ì •)',
                        data: [35, 25, 20, 15, 5],
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.7)', // Red
                            'rgba(245, 158, 11, 0.7)', // Amber
                            'rgba(59, 130, 246, 0.7)', // Blue
                            'rgba(16, 185, 129, 0.7)', // Green
                            'rgba(107, 114, 128, 0.7)'  // Gray
                        ],
                        borderColor: [
                            'rgba(239, 68, 68, 1)',
                            'rgba(245, 158, 11, 1)',
                            'rgba(59, 130, 246, 1)',
                            'rgba(16, 185, 129, 1)',
                            'rgba(107, 114, 128, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `ì˜í–¥ë„: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ë°œìƒ ë¹„ìœ¨ (%)'
                            }
                        }
                    }
                }
            });
        }
    };

    // Initialize App
    document.addEventListener('DOMContentLoaded', () => {
        app.init();
    });

</script>
</body>
</html>